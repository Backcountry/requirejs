<!DOCTYPE html>
<html>
<head>
    <title>require.js: Combo Test</title>
    <script type="text/javascript" src="../doh/runner.js"></script>
    <script type="text/javascript" src="../doh/_browserRunner.js"></script>
    <script type="text/javascript" src="../../require.js"></script>
    <script>

    //Set up base path, need a / in the URL so that RequireJS
    //does not try to append .js to the URL.
    var basePath = location.pathname.split('/');
    basePath.pop();
    basePath = basePath.join('/') + '/combo.js';

    //Comment this out if using local file. Otherwise, start up
    //combo server using "node comboserver.js" with Node 0.4+
    basePath = 'http://127.0.0.1:8123/';

    //Set up combo service.
    require({
        combo: {
            deps: [],
            add: function (prefix, name, url, config) {
                //Skip loader plugins and any module named three,
                //and any dependencies generated by the combo service itself.
                if (!prefix && name !== 'three' &&
                    name.indexOf(basePath) === -1) {
                    this.deps.push(name + '@' + url);
                    return true;
                }
                return false;
            },
            done: function (req, config) {
                if (!this.deps.length) {
                    return;
                }

                var url = basePath + '?' + this.deps.join('^');
                this.deps = [];
                req([url]);
            }
        }
    });


    require(['one', 'two', 'three', 'four', 'five'],
    function (one,   two,   three,   four,   five) {

        doh.register(
            "combo",
            [
                function combo(t){
                    t.is("one", one.name);
                    t.is("two", two.name);
                    t.is("three", three.name);
                    t.is("four", four.name);
                    t.is("five", five.name);
                }
            ]
        );

        doh.run();

    });
    </script>
</head>
<body>
    <h1>require.js: Combo Test</h1>
    <p>Check console for messages</p>
</body>
</html>
